# 基于TCP/IP协议键盘控制下位机

## 项目简介

该项目实现了一个基于 TCP/IP 协议的应用程序，允许用户通过键盘输入数据，并将这些数据发送到下位机（设备）。上位机通过 TCP 连接到下位机，并发送 16 位整数数据。下位机接收数据并进行 CRC 校验，确保数据的完整性和准确性。

## 功能特性

- **TCP/IP 连接**：上位机与下位机之间通过 TCP/IP 协议进行通信。
- **实时数据输入**：用户可以通过按键输入实时发送数据。
- **CRC 校验**：数据传输过程中使用 CRC-8 校验确保数据完整性。
- **数据格式**：数据以特定帧格式发送，包含帧头、数据、CRC 校验和帧尾。

## 环境要求

- Python 3.x
- `keyboard` 库（用于检测键盘输入）
- 网络连接

## 安装与运行

1. **克隆项目**：
   ```bash
   git clone <项目仓库地址>
   cd <项目目录>
   ```

2. **安装依赖**：
   ```bash
   pip install keyboard
   ```

3. **运行下位机（Slave）**：
   ```bash
   python slave.py
   ```

4. **运行上位机（Host）**：
   ```bash
   python host.py
   ```

## 使用说明

1. 启动下位机程序，等待上位机连接。
2. 启动上位机程序，输入下位机的 IP 地址和端口号（默认 IP 为 `192.168.2.171`，端口为 `12345`）。
3. 按下以下键发送数据：
   - 按下 `a` 发送 +30
   - 按下 `d` 发送 -30
   - 按下 `q` 退出程序

## 数据帧格式

数据通过特定格式的帧进行传输，格式如下：

- **帧头**：`0x30`（固定值）
- **数据**：16 位整数（小端格式）
- **CRC 校验**：通过 CRC-8 计算得出的校验值
- **帧尾**：`0x40`（固定值）

### 示例数据帧

发送 +30 的数据帧示例：
```
帧: [0x30, 0x1E, 0x00, CRC, 0x40]
```

## 示例

```bash
已连接到服务器。按下 'a' 发送 +30，按下 'd' 发送 -30，按 'q' 退出。
发送帧: [48, 30, 0, 0, CRC, 64]
接收到的值: 30
```

## 代码说明

### 上位机（Host）

上位机代码通过键盘输入发送 16 位整数到下位机。它计算数据的 CRC 校验，并将数据打包成帧格式发送。

### 下位机（Slave）

下位机代码接收数据，检查数据帧的完整性，验证 CRC 校验，并解包出发送的 16 位整数。如果 CRC 校验失败，则输出错误信息。

## 贡献

欢迎任何形式的贡献！请提交问题、建议或拉取请求。